<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AfroEscape</title>
    <link rel="shortcut icon" href="https://media.licdn.com/dms/image/v2/D5622AQFGSYr2Ca62uA/feedshare-shrink_800/feedshare-shrink_800/0/1692714257810?e=1731542400&v=beta&t=bIRgv39gTakXR93i6OTwNJ_Xd8dwSiBHshbb-Gxt-uk" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="/styles/styles.css">
    <script src="https://kit.fontawesome.com/7c2aa39bd5.js" crossorigin="anonymous"></script>
    <script src="script.js"></script><script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <script src="assets/app.js"></script>
</head>


<body>
    <header>
        <img src="/assets/img/bgn logo.png" alt="Logo" class="logo">
        <h1 class="company-name">AfroEscape</h1>
        <a href="collab.html"><button class="sign"> Join the Community </button></a>
        <button class="log-in">Share </button>
    </header>

 
  <div id="type-container">
    <h2>Choose your adventure!</h2>
    <div class="btns">
        <button class="btn btn-primary btn-lg" id="casual-btn">Casual</button>
        <button class="btn btn-secondary btn-lg" id="cultural-btn">Cultural</button>
        <button class="btn btn-secondary btn-lg" id="random-btn">Randomise</button>
    </div>
</div> 

<div id="find-afro-events">
  <div id="find-events-by-city">
    <h1>Find Afro Events by City:</h1>

    <input type="text" id="cityInput" placeholder="Enter city name">
    <button id="searchButton">Search for Afro Events</button>
  </div>

  <div id="results"></div>
</div>


<p id="location">Fetching your location...</p>
     <div id="map"></div>
     <div id="events"></div>
     <script src="script.js"></script>
     <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6qN570cNfqmTDTf9QPE8rhNgKOoMhPhE&async=defer"></script>
     <script src="assets/app.js"></script>

<script>
  const searchButton = document.getElementById('searchButton');

  searchButton.addEventListener('click', function () {
    const city = document.getElementById('cityInput').value.trim();

    if (city) {
      searchAfroEvents(city);
    } else {
      alert('Please enter a city name.');
    }
  });

  function searchAfroEvents(city) {
    const apiKey = 'M9XikQZGe69Zth1vtg7m88V58i2csv3r'; 
    const url = `https://app.ticketmaster.com/discovery/v2/events.json?keyword=afro&city=${city}&apikey=${apiKey}`;

    fetch(url)
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: 
          ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        if (data._embedded && data._embedded.events) {
          displayResults(data._embedded.events);
        } else {
          document.getElementById('results').innerHTML = 'No events found.';
        }
      })
      .catch(error => {
        console.error('Error:', error);
        document.getElementById('results').innerHTML = 'Error fetching events. Please try again later.';
      });
  }

  function displayResults(events) {
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = ''; 

    let minLnt = Number.MAX_SAFE_INTEGER;
    events.forEach(event => {
      minLnt = Math.min(event.name.length, minLnt);
    });

    events.forEach(event => {
      const eventDiv = document.createElement('div');
      const clippedEventName = event.name.substring(0, minLnt);
      eventDiv.id = 'event-${index}';
      eventDiv.innerHTML = `
        <img src="${event.images[0].url}" alt="${event.name}" width="200">
        <div id="event-info">
        <h3>${clippedEventName}</h3>
        <p>Date: ${event.dates.start.localDate}</p>
        <a href="${event.url}" target="_blank">More Info</a>
        </div>
        <hr>
      `;
      resultsDiv.appendChild(eventDiv);
    });
  }


  // Function to show event list with details (name, date, time, venue, and ticket URL)

// Function to show event list with details (name, date, time, venue, and ticket URL)
function showEvents(json) {
    var eventsDiv = document.getElementById("events");
    eventsDiv.innerHTML = ""; // Clear previous results
    if (json._embedded && json._embedded.events) {
        // Limit to a maximum of 10 events
        var maxEvents = Math.min(json._embedded.events.length, 10
        );
        for (var i = 0; i < maxEvents; i++) {
            var event = json._embedded.events[i];
            var name = event.name;
            var date = event.dates.start.localDate || "No date available";
            var time = event.dates.start.localTime || "No time available";
            var venue = event._embedded.venues[0].name || "Venue not available";
            var ticketUrl = event.url || "#";

            eventsDiv.innerHTML += `
              <div class="col-med-3 mb-4">
    <div class="card h-75 box-shadow custom-card">
        <div class="card-body">
            <h3 class="card-title text-danger">${name}</h3>
            <p class="card-text"><strong>Date:</strong> ${date}</p>
            <p class="card-text"><strong>Time:</strong> ${time}</p>
            <p class="card-text"><strong>Venue:</strong> ${venue}</p>
           <a href="${ticketUrl}" class="btn btn-success btn-block" target="_blank">Get Tickets</a>

        </div>
    </div>
</div>

            `;
        }
    } else {
        eventsDiv.innerHTML = "<p>No AFRICAN CARRIBBEAN events found.</p>";
    }
}


  // Function to get user location
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
    } else {
        document.getElementById("location").innerHTML = "Geolocation is not supported by this browser.";
    }
}

// Function to display location
function showPosition(position) {
    var locationElement = document.getElementById("location");
    locationElement.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude;

    var latlon = position.coords.latitude + "," + position.coords.longitude;

    // Ticketmaster call with the keyword 
    $.ajax({
        type: "GET",
        url: "https://app.ticketmaster.com/discovery/v2/events.json",
        data: {
            apikey: "M9XikQZGe69Zth1vtg7m88V58i2csv3r", 
            latlong: latlon,
            keyword: "Afro", 
            radius: 600,      
        },
        async: true,
        dataType: "json",
        success: function(json) {
            console.log(json);
            var eventsElement = document.getElementById("events");
            eventsElement.innerHTML = json.page.totalElements + " events found.";
            showEvents(json);
            initMap(position, json);
        },
        error: function(xhr, status, err) {
            console.log(err);
        }
    });
}

// Function to initialize and display Google 
function initMap(position, json) {
    var mapDiv = document.getElementById('map');
    var map = new google.maps.Map(mapDiv, {
        center: { lat: position.coords.latitude, lng: position.coords.longitude },
        zoom: 10
    });

    
    if (json._embedded && json._embedded.events) {
        json._embedded.events.forEach(function(event) {
            var eventLocation = {
                lat: event._embedded.venues[0].location.latitude,
                lng: event._embedded.venues[0].location.longitude
            };
            var marker = new google.maps.Marker({
                position: eventLocation,
                map: map,
                title: event.name
            });
        });
    }
}


function showError(error) {
    var locationElement = document.getElementById("location");
    switch (error.code) {
        case error.PERMISSION_DENIED:
            locationElement.innerHTML = "User denied the request for Geolocation.";
            break;
        case error.POSITION_UNAVAILABLE:
            locationElement.innerHTML = "Location information is unavailable.";
            break;
        case error.TIMEOUT:
            locationElement.innerHTML = "The request to get user location timed out.";
            break;
        case error.UNKNOWN_ERROR:
            locationElement.innerHTML = "An unknown error occurred.";
            break;
    }
}


window.onload = getLocation;


</script>





    
     
</body>


</html>